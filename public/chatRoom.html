<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>CHAT ROOM</title>
  <meta name="viewport" content="width = device-width,initial-scale = 1.0">
  <meta name="description" content="This is your room number">
  <link rel="stylesheet" href="/stylesheets/chatRoom.css" type="text/css">  
   <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
</head>
<body>  


 
<!-- share API Reference from: https://www.youtube.com/watch?v=sMJZqLLp0Cc-->
 
 <button id="shareButton" onclick="share(this)">
    <i class="fas fa-share-alt"></i>
     <i class="fas fa-times"></i>
  <div class="container">
    <div class="addthis_inline_share_toolbox">
</div>
    
    <!--for old users of AddThis-->
   <div class="addthis_sharing_toolbox"></div>
  </div>
</button> 
    <form action="/logout_action" method="POST">
        <button type="submit" id="logoutbutton">Log out</button>
    </form>

       <!-- chatRoom -->
       <p id='server-time'></p>
       <p id='message_display'></p>    
      <form class="" action="javascript:void(0)">
        <input type="text" id="message_input" name="" value="" required autofocus><button>Send</button>
      </form>
    
      <script src="/socket.io/socket.io.js"></script>;
      <script>
        var socket = io();
        var el = document.getElementById('server-time');
        var dis=document.getElementById('message_display');
        socket.on('time',function(timeString){
          el.innerHTML='Server time: '+ timeString;
        });
        socket.on('message',function(msg){
          dis.innerHTML+=`${name} Message: ${msg} <br />`;
        });
        document.forms[0].onsubmit=function(){
          var input=document.getElementById("message_input");
          var msg=input.value;
          socket.emit("chat",msg);
          input.value='';
        } 

    
    //share API
    var AddThisJSLoaded = false; //AddThis not loaded yet
    var clickedOnShare = false; //share button is not clicked
    var AddThisPubID = "ra-5dd0449a0cd80efa";
    var AddThisJS = "//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5dd0449a0cd80efa";

  function share(button) {
  if (navigator.share) {
    //check if Web Share API is supported by the browser
    //var url = document.location.href;
    var title = document.getElementsByTagName("title")[0].innerHTML;
    var description = document
      .querySelector("meta[name=description]")
      .getAttribute("content");
    navigator.share({
      title: title,
      text: description,
      url: "https://stark-chamber-06109.herokuapp.com/logout_action#t4"

    });
  } else {
    if (!AddThisJSLoaded && !clickedOnShare) {
      //when AddThis not loaded and share button isn't clicked
      clickedOnShare = true; //share button is clicked
      showLoading(button);
      shareByAddThis(button);
    } else {
      toggleAddThisButtons(button);
    }
  }
}

function shareByAddThis(button) {
  var script = document.createElement("script");
  script.async = true;
  script.src = AddThisJS;

  script.onload = function() {
    clickedOnShare = false; //AddThis JS is loaded
    addthis.user.ready(function(data) {
      AddThisJSLoaded = true; //AddThis loaded and ready to use
      hideLoading(button);
      showAddThisButtons(button);
    });
  };

  script.onerror = function() {
    clickedOnShare = false; //AddThis JS failed to load
    hideLoading(button);
  };

  document.body.appendChild(script);
}

function showLoading(button) {
  button.classList.add("loading");
}

function hideLoading(button) {
  button.classList.remove("loading");
}

function showAddThisButtons(button) {
  button.classList.add("showAddThisButtons");
}

function toggleAddThisButtons(button) {
  button.classList.toggle("showAddThisButtons");
} 

</script>

</body>
</html>
